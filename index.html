<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ€§èƒ½å¸¦å®½è®¡ç®—å™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background-color: #121826;
            color: #e0e6ef;
            line-height: 1.6;
            padding: 10px;
            max-width: 100%;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* æ±‰å ¡èœå•æŒ‰é’® - æ˜¾è‘—åŠ å¤§ */
        .hamburger-menu-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 50px; /* æ˜¾è‘—åŠ å¤§ï¼šä»40pxå¢åŠ åˆ°50px */
            height: 50px; /* æ˜¾è‘—åŠ å¤§ï¼šä»40pxå¢åŠ åˆ°50px */
            border-radius: 8px; /* å¢åŠ åœ†è§’ */
            background: none;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .hamburger-menu-btn:hover {
            background-color: rgba(106, 17, 203, 0.2); /* åŠ æ·±hoveræ•ˆæœ */
        }
        
        /* ä¸‰æ¨ªçº¿å›¾æ ‡ - ä¼˜åŒ–ï¼šåŠ é•¿ã€å˜ç»†ã€é—´è·ç¼©å°ï¼Œå¢åŠ é€æ˜åº¦ */
        .hamburger-icon {
            width: 50px; /* æ˜¾è‘—åŠ é•¿ï¼šä»45pxå¢åŠ åˆ°50px */
            height: 24px; /* å‡å°é«˜åº¦ï¼šä»30pxå‡å°åˆ°24px */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* æ”¹ä¸ºspace-betweenï¼Œä½¿ä¸‰æ¡çº¿é—´è·å‡åŒ€åˆ†å¸ƒ */
            align-items: center;
        }
        
        .hamburger-icon span {
            display: block;
            width: 100%;
            height: 3px; /* å˜ç»†ï¼šä»4pxå‡å°‘åˆ°3px */
            background-color: rgba(224, 230, 239, 0.7); /* å¢åŠ é€æ˜åº¦ï¼šä»å®Œå…¨ä¸é€æ˜æ”¹ä¸º70%ä¸é€æ˜ */
            border-radius: 1.5px; /* è°ƒæ•´åœ†è§’ */
            transition: all 0.3s ease;
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            min-height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
        }
        
        .main-content.settings-open {
            transform: translateX(50%);
            filter: brightness(0.7);
            overflow: hidden !important;
            touch-action: none;
            height: 100vh;
            position: fixed;
            width: 100%;
        }
        
        /* è®¾ç½®é¢æ¿ - å·²ç§»é™¤å³ä¸Šè§’XæŒ‰é’® */
        .settings-panel {
            position: fixed;
            top: 0;
            left: -50%;
            width: 50%;
            height: 100vh;
            background: #1e2430;
            border-right: 1px solid #2a3140;
            z-index: 99;
            overflow-y: auto;
            padding: 20px;
            transition: left 0.3s ease;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.3);
        }
        
        .settings-panel.open {
            left: 0;
        }
        
        .settings-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #2a3140;
        }
        
        .settings-title {
            font-size: 1.3rem;
            color: #e0e6ef;
            margin-left: 10px;
        }
        
        /* ç®€æ´çš„è®¾ç½®é¡¹æ ·å¼ */
        .settings-item {
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .item-header {
            display: flex;
            align-items: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 1px solid transparent;
        }
        
        .item-header:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .item-header.active {
            border-bottom: 1px solid #2a3140;
            background-color: rgba(255, 255, 255, 0.03);
        }
        
        .item-content-wrapper {
            display: flex;
            align-items: center;
            flex-grow: 1;
            gap: 12px;
        }
        
        .item-icon {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .update-icon {
            background: rgba(46, 204, 113, 0.1);
            color: #2ecc71;
        }
        
        .share-icon {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }
        
        .about-icon {
            background: rgba(155, 89, 182, 0.1);
            color: #9b59b6;
        }
        
        .item-text {
            flex-grow: 1;
        }
        
        .item-title {
            font-weight: 600;
            font-size: 0.95rem;
            color: #e0e6ef;
        }
        
        .item-desc {
            font-size: 0.8rem;
            color: #a0a6b0;
            margin-top: 3px;
        }
        
        /* ç§»é™¤ä¸‰è§’æ ‡è¯†ï¼Œä¸æ˜¾ç¤ºä»»ä½•ç®­å¤´ */
        .item-toggle {
            display: none;
        }
        
        .item-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
        }
        
        .item-content.active {
            max-height: 500px;
            transition: max-height 0.5s ease-in;
        }
        
        .content-inner {
            padding: 15px;
            padding-top: 10px;
        }
        
        /* æ£€æµ‹æ›´æ–°å†…å®¹æ ·å¼ */
        .update-content {
            text-align: center;
            padding: 10px 0;
        }
        
        .update-status {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            color: #e0e6ef;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .check-update-btn {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 0 auto;
            height: 40px; /* å›ºå®šé«˜åº¦ */
            min-width: 120px; /* æœ€å°å®½åº¦ */
            position: relative; /* ä¸ºæ—‹è½¬åœ†åœˆå®šä½ */
        }
        
        .check-update-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(106, 17, 203, 0.5);
        }
        
        .check-update-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        /* åˆ†äº«é€‰é¡¹æ ·å¼ - æ¨ªæ’å¸ƒå±€ */
        .share-options {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 15px;
        }
        
        .share-option {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: #2a3140;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            min-height: 120px;
        }
        
        .share-option:hover {
            background: #3a4255;
            transform: translateY(-2px);
        }
        
        .share-option-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .share-option-title {
            font-weight: 600;
            font-size: 0.9rem;
            color: #e0e6ef;
            margin-bottom: 5px;
        }
        
        .share-option-desc {
            font-size: 0.8rem;
            color: #a0a6b0;
        }
        
        .copy-success {
            color: #2ecc71;
            font-size: 0.8rem;
            margin-top: 10px;
            display: none;
            text-align: center;
        }
        
        /* åˆ†äº«æç¤ºæ–‡å­—æ ·å¼ - ä¿®æ”¹ï¼šå·¦ä¾§å¯¹é½ï¼Œæ·»åŠ å¥å· */
        .share-hint {
            color: #e0e6ef;
            font-size: 0.9rem;
            text-align: left; /* ä¿®æ”¹ï¼šä»centeræ”¹ä¸ºleft */
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        /* äºŒç»´ç å¼¹çª—æ ·å¼ */
        .qrcode-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .qrcode-modal-content {
            background: #1e2430;
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #2a3140;
            text-align: center;
        }
        
        .qrcode-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #2a3140;
        }
        
        .qrcode-modal-title {
            font-size: 1.3rem;
            color: #e0e6ef;
        }
        
        .close-qrcode-modal {
            background: none;
            border: none;
            color: #a0a6b0;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .close-qrcode-modal:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: #e0e6ef;
        }
        
        .qrcode-placeholder {
            padding: 30px;
            background: white;
            border-radius: 10px;
            margin: 0 auto 20px;
            display: inline-block;
            width: 200px;
            height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .qrcode-placeholder-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            color: #333;
        }
        
        .qrcode-placeholder-text {
            color: #666;
            font-size: 0.9rem;
            text-align: center;
        }
        
        .qrcode-hint {
            color: #a0a6b0;
            font-size: 0.9rem;
            margin-top: 15px;
        }
        
        .about-content {
            line-height: 1.6;
            padding: 10px 0;
        }
        
        .about-content p {
            margin-bottom: 12px;
            font-size: 0.9rem;
            color: #e0e6ef;
        }
        
        .version-info {
            background: #2a3140;
            border-radius: 6px;
            padding: 12px;
            margin-top: 15px;
        }
        
        .version-info p {
            margin-bottom: 5px;
            font-size: 0.85rem;
            color: #a0a6b0;
        }
        
        .version {
            color: #6a11cb;
            font-weight: 600;
        }
        
        /* æ£€æµ‹æ›´æ–°æ—‹è½¬åœ†åœˆ - ä¼˜åŒ–ï¼šä¸æ–‡å­—å±…ä¸­å¯¹é½ */
        .spinner {
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 2px solid #6a11cb;
            width: 16px; /* ç¨å¾®å¢å¤§ï¼Œç¡®ä¿å¯è§æ€§ */
            height: 16px; /* ç¨å¾®å¢å¤§ï¼Œç¡®ä¿å¯è§æ€§ */
            animation: spin 1s linear infinite;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 30px;
        }
        
        header {
            text-align: center;
            padding: 20px 10px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            /* ä¸æ·»åŠ å·¦ä¾§paddingï¼Œä¿æŒåŸå§‹å¸ƒå±€ */
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
            max-width: 90%;
            margin: 0 auto;
        }
        
        .card {
            background: #1e2430;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            border: 1px solid #2a3140;
        }
        
        .card-title {
            font-size: 1.2rem;
            color: #e0e6ef;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2a3140;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: nowrap;
            gap: 10px;
        }
        
        .card-title-text {
            display: flex;
            align-items: center;
            white-space: nowrap;
            flex-grow: 1;
            min-width: 0; /* é˜²æ­¢æ–‡æœ¬æº¢å‡º */
        }
        
        .card-title i {
            margin-right: 10px;
            color: #6a11cb;
        }
        
        /* æ¨¡å¼åˆ‡æ¢æŒ‰é’®æ ·å¼ */
        .mode-toggle-btn {
            min-width: 70px;
            height: 30px;
            border-radius: 6px;
            border: none;
            color: white;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            padding: 0 8px;
            gap: 4px;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .mode-toggle-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .mode-toggle-btn:active {
            transform: translateY(0);
        }
        
        .mode-toggle-btn.small-better {
            background: rgba(231, 76, 60, 0.4); /* çº¢è‰²åŠ æ·± */
        }
        
        .mode-toggle-btn.large-better {
            background: rgba(46, 204, 113, 0.4); /* ç»¿è‰²åŠ æ·± */
        }
        
        /* å›¾è¡¨ä¸‹è½½æŒ‰é’®æ ·å¼ - ä½¿ç”¨ç¬¬ä¸€ä¸ªå›¾æ ‡ï¼ˆç®€æ´ç®­å¤´ï¼‰ */
        .download-chart-btn {
            width: 30px; /* ä¸æ¨¡å¼åˆ‡æ¢æŒ‰é’®é«˜åº¦ä¸€è‡´ */
            height: 30px;
            border-radius: 6px; /* ä¸æ¨¡å¼åˆ‡æ¢æŒ‰é’®ä¸€è‡´ */
            border: none;
            background: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            padding: 0;
            flex-shrink: 0;
            position: relative;
            margin-right: 0; /* ç¡®ä¿å¯¹é½ */
        }
        
        .download-chart-btn:hover {
            background-color: rgba(106, 17, 203, 0.1);
            transform: translateY(-1px);
        }
        
        .download-chart-btn:active {
            transform: translateY(0);
        }
        
        /* ä½¿ç”¨ç¬¬ä¸€ä¸ªå›¾æ ‡ï¼šç®€æ´ç®­å¤´ */
        .download-icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            position: relative;
        }
        
        .download-icon::before {
            content: '';
            position: absolute;
            top: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 7px solid transparent;
            border-right: 7px solid transparent;
            border-top: 12px solid #e0e6ef;
        }
        
        .download-icon::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 17px;
            height: 2px;
            background-color: #e0e6ef;
            border-radius: 1px;
        }
        
        .download-chart-btn:hover .download-icon::before {
            border-top-color: #6a11cb;
        }
        
        .download-chart-btn:hover .download-icon::after {
            background-color: #6a11cb;
        }
        
        /* è¾“å…¥æ¡†æ ·å¼ */
        .input-section textarea {
            width: 100%;
            min-height: 100px;
            max-height: 300px;
            padding: 15px;
            border: 2px solid #3a4255;
            border-radius: 10px;
            font-size: 1rem;
            resize: none;
            transition: all 0.3s;
            background-color: #2a3140;
            color: #e0e6ef; /* æ­£å¸¸æ–‡æœ¬é¢œè‰² */
            overflow-y: auto;
        }
        
        /* æç¤ºæ–‡æœ¬æ ·å¼ - æ–°å¢ */
        .input-section textarea.placeholder-text {
            color: #a0a6b0; /* æµ…è‰²æç¤ºæ–‡æœ¬ï¼Œä¸.input-hinté¢œè‰²ä¸€è‡´ */
        }
        
        .input-section textarea:focus {
            outline: none;
            border-color: #6a11cb;
        }
        
        .input-hint {
            font-size: 0.85rem;
            color: #a0a6b0;
            margin-top: 8px;
            margin-bottom: 15px;
        }
        
        .btn-group-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
        }
        
        .btn-primary:hover, .btn-primary:active {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(106, 17, 203, 0.5);
        }
        
        .btn-secondary {
            background: #3a4255;
            color: #e0e6ef;
        }
        
        .btn-secondary:hover, .btn-secondary:active {
            background: #4a5265;
        }
        
        .btn-danger {
            background: #ff4757;
            color: white;
        }
        
        .btn-danger:hover, .btn-danger:active {
            background: #ff6b81;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(255, 71, 87, 0.3);
        }
        
        /* LACUåŒºé—´æ–¹å—å¸ƒå±€ */
        .lacu-container {
            margin-top: 5px;
        }
        
        .lacu-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        
        .lacu-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px 10px;
            border-radius: 12px;
            text-align: center;
            min-height: 100px;
        }
        
        .lacu-label {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .lacu-range {
            font-size: 1.1rem;
            line-height: 1.4;
            font-weight: 700;
        }
        
        .L-box { 
            background-color: rgba(231, 76, 60, 0.15); 
            border: 2px solid rgba(231, 76, 60, 0.4);
        }
        .A-box { 
            background-color: rgba(243, 156, 18, 0.15); 
            border: 2px solid rgba(243, 156, 18, 0.4);
        }
        .C-box { 
            background-color: rgba(46, 204, 113, 0.15); 
            border: 2px solid rgba(46, 204, 113, 0.4);
        }
        .U-box { 
            background-color: rgba(52, 152, 219, 0.15); 
            border: 2px solid rgba(52, 152, 219, 0.4);
        }
        
        .L-label { color: #e74c3c; }
        .A-label { color: #f39c12; }
        .C-label { color: #2ecc71; }
        .U-label { color: #3498db; }
        
        /* ç»Ÿè®¡æ‘˜è¦ */
        .stats-summary {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 12px 0;
            border-top: 1px solid #2a3140;
            font-size: 0.95rem;
            color: #e0e6ef;
        }
        
        .chart-container {
            position: relative;
            height: 380px;
            width: 100%;
            margin-top: 10px;
        }
        
        .note {
            font-size: 0.85rem;
            color: #a0a6b0;
            margin-top: 20px;
            padding: 15px;
            background: #2a3140;
            border-radius: 10px;
            border-left: 4px solid #6a11cb;
        }
        
        /* ä¿®å¤ï¼šç§»é™¤chart-sectionçš„ç‰¹æ®Šæ ·å¼ï¼Œä½¿ç”¨é€šç”¨æ ·å¼ */
        .results-section .card-title,
        .lacu-definition-section .card-title {
            display: block;
            padding-bottom: 10px;
            border-bottom: 2px solid #2a3140;
        }
        
        .results-section .card-title-text,
        .lacu-definition-section .card-title-text {
            display: flex;
            align-items: center;
        }
        
        /* ç‰¹åˆ«ä¸ºchart-sectionä¿æŒflexå¸ƒå±€ */
        .chart-section .card-title {
            /* ä¿æŒflexå¸ƒå±€ï¼Œä¸è¦è¦†ç›–ä¸ºblock */
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 10px;
            border-bottom: 2px solid #2a3140;
        }
        
        .chart-section .card-title-text {
            display: flex;
            align-items: center;
        }
        
        /* å½“å‰æ¨¡å¼æç¤ºæ ·å¼ - é¢œè‰²æ”¹ä¸ºç™½è‰² */
        .current-mode-hint {
            font-size: 0.9rem;
            color: #ffffff; /* æ”¹ä¸ºç™½è‰² */
            font-weight: 600;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #3a4255;
        }
        
        /* é¡µè„šæ ·å¼ */
        .footer {
            text-align: center;
            color: #a0a6b0;
            padding: 20px 0;
            font-size: 0.85rem;
            margin-top: 20px;
            border-top: 1px solid #2a3140;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .lacu-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .lacu-box {
                padding: 18px 8px;
                min-height: 90px;
            }
            
            .lacu-label {
                font-size: 1.6rem;
                margin-bottom: 8px;
            }
            
            .lacu-range {
                font-size: 1rem;
                font-weight: 700;
            }
            
            .chart-container {
                height: 320px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .card-title {
                font-size: 1.1rem;
            }
            
            .mode-toggle-btn {
                min-width: 65px;
                height: 28px;
                font-size: 0.8rem;
                padding: 0 6px;
            }
            
            /* ç¡®ä¿åœ¨æ‰‹æœºç«¯æ ‡é¢˜æ–‡æœ¬ä¸ä¼šè¿‡é•¿ */
            .card-title-text {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: calc(100% - 50px); /* ä¸ºæŒ‰é’®ç•™å‡ºç©ºé—´ */
            }
            
            .download-chart-btn {
                width: 28px;
                height: 28px;
            }
            
            .download-icon {
                width: 22px;
                height: 22px;
            }
            
            .download-icon::before {
                border-left: 6px solid transparent;
                border-right: 6px solid transparent;
                border-top: 10px solid #e0e6ef;
            }
            
            .download-icon::after {
                width: 15px;
                height: 2px;
            }
            
            .footer {
                font-size: 0.8rem;
                padding: 15px 0;
            }
            
            /* æ‰‹æœºç«¯è®¾ç½®é¢æ¿å®½åº¦ */
            .settings-panel {
                width: 85%;
                left: -85%;
            }
            
            .main-content.settings-open {
                transform: translateX(85%);
            }
            
            /* æ‰‹æœºç«¯ä¸‰æ¨ªçº¿ä¹Ÿä¼˜åŒ– */
            .hamburger-menu-btn {
                top: 18px;
                left: 18px;
                width: 46px; /* æ‰‹æœºç«¯ä¹ŸåŠ å¤§ */
                height: 46px; /* æ‰‹æœºç«¯ä¹ŸåŠ å¤§ */
            }
            
            .hamburger-icon {
                width: 40px; /* æ‰‹æœºç«¯ä¹ŸåŠ é•¿ */
                height: 20px; /* æ‰‹æœºç«¯å‡å°é«˜åº¦ */
            }
            
            .hamburger-icon span {
                height: 3px; /* ä¿æŒåŠ ç²— */
                background-color: rgba(224, 230, 239, 0.7); /* ä¿æŒé€æ˜åº¦ */
            }
            
            /* æ‰‹æœºç«¯åˆ†äº«é€‰é¡¹ä¿æŒæ¨ªæ’ */
            .share-options {
                flex-direction: row;
                gap: 10px;
            }
            
            .share-option {
                padding: 12px;
                min-height: 110px;
            }
            
            .share-option-icon {
                font-size: 1.8rem;
                height: 35px;
            }
            
            .share-option-title {
                font-size: 0.85rem;
            }
            
            .share-option-desc {
                font-size: 0.75rem;
            }
        }
        
        @media (max-width: 480px) {
            /* æ‰‹æœºç«¯æŒ‰é’®ä¿æŒæ¨ªå‘æ’åˆ— */
            .btn-group-3 {
                grid-template-columns: 1fr 1fr 1fr; /* ä¿æŒä¸‰åˆ—å¸ƒå±€ */
                gap: 8px;
            }
            
            .btn-group-3 button {
                font-size: 0.85rem;
                padding: 12px 6px;
            }
            
            .btn-group-3 button span.long-text {
                display: none;
            }
            
            .btn-group-3 button span.short-text {
                display: inline;
            }
            
            .lacu-grid {
                gap: 8px;
            }
            
            .lacu-box {
                padding: 15px 5px;
                min-height: 85px;
            }
            
            .lacu-label {
                font-size: 1.5rem;
            }
            
            .lacu-range {
                font-size: 0.95rem;
                font-weight: 700;
            }
            
            .chart-container {
                height: 300px;
            }
            
            .card-title {
                font-size: 1rem;
                gap: 8px;
            }
            
            .mode-toggle-btn {
                min-width: 60px;
                height: 26px;
                font-size: 0.75rem;
                padding: 0 5px;
            }
            
            .download-chart-btn {
                width: 26px;
                height: 26px;
            }
            
            .download-icon {
                width: 20px;
                height: 20px;
            }
            
            .download-icon::before {
                border-left: 5px solid transparent;
                border-right: 5px solid transparent;
                border-top: 9px solid #e0e6ef;
            }
            
            .download-icon::after {
                width: 13px;
                height: 2px;
            }
            
            /* åœ¨è¶…å°å±å¹•ä¸Šè¿›ä¸€æ­¥è°ƒæ•´æ ‡é¢˜æ–‡æœ¬ */
            .card-title-text {
                max-width: calc(100% - 40px);
            }
            
            /* è¶…å°å±å¹•è®¾ç½®é¢æ¿å®½åº¦ */
            .settings-panel {
                width: 85%;
                left: -85%;
            }
            
            .main-content.settings-open {
                transform: translateX(85%);
            }
            
            /* è¶…å°å±å¹•ä¸‰æ¨ªçº¿ä¹Ÿä¼˜åŒ– */
            .hamburger-menu-btn {
                top: 15px;
                left: 15px;
                width: 44px; /* è¶…å°å±å¹•ä¹ŸåŠ å¤§ */
                height: 44px; /* è¶…å°å±å¹•ä¹ŸåŠ å¤§ */
            }
            
            .hamburger-icon {
                width: 38px; /* è¶…å°å±å¹•ä¹ŸåŠ é•¿ */
                height: 18px; /* è¶…å°å±å¹•å‡å°é«˜åº¦ */
            }
            
            .hamburger-icon span {
                height: 2.5px; /* è¿›ä¸€æ­¥å˜ç»† */
                background-color: rgba(224, 230, 239, 0.7); /* ä¿æŒé€æ˜åº¦ */
            }
            
            .settings-header {
                margin-bottom: 20px;
            }
            
            .settings-title {
                font-size: 1.2rem;
            }
            
            .item-header {
                padding: 12px;
            }
            
            .content-inner {
                padding: 12px;
                padding-top: 8px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            /* è¶…å°å±å¹•åˆ†äº«é€‰é¡¹è°ƒæ•´ */
            .share-options {
                gap: 8px;
            }
            
            .share-option {
                padding: 10px 8px;
                min-height: 100px;
            }
            
            .share-option-icon {
                font-size: 1.6rem;
                height: 30px;
                margin-bottom: 8px;
            }
            
            .share-option-title {
                font-size: 0.8rem;
            }
            
            .share-option-desc {
                font-size: 0.7rem;
            }
            
            .qrcode-placeholder {
                width: 180px;
                height: 180px;
                padding: 20px;
            }
            
            .qrcode-placeholder-icon {
                font-size: 3rem;
            }
        }
        
        @media (max-width: 360px) {
            .card-title {
                font-size: 0.95rem;
            }
            
            .mode-toggle-btn {
                min-width: 55px;
                font-size: 0.7rem;
            }
            
            .download-chart-btn {
                width: 24px;
                height: 24px;
            }
            
            .download-icon {
                width: 18px;
                height: 18px;
            }
            
            .download-icon::before {
                border-left: 4px solid transparent;
                border-right: 4px solid transparent;
                border-top: 8px solid #e0e6ef;
            }
            
            .download-icon::after {
                width: 12px;
                height: 1.5px;
            }
            
            .footer {
                font-size: 0.75rem;
                padding: 10px 0;
            }
            
            /* è¶…å°å±å¹•æŒ‰é’®è°ƒæ•´ */
            .btn-group-3 button {
                font-size: 0.8rem;
                padding: 10px 4px;
            }
            
            /* è¶…å°å±å¹•ä¸‰æ¨ªçº¿ä¿æŒä¼˜åŒ– */
            .hamburger-menu-btn {
                width: 42px; /* è¶…å°å±å¹•ä¿æŒåŠ å¤§ */
                height: 42px; /* è¶…å°å±å¹•ä¿æŒåŠ å¤§ */
            }
            
            .hamburger-icon {
                width: 36px; /* è¶…å°å±å¹•ä¿æŒåŠ é•¿ */
                height: 16px; /* è¶…å°å±å¹•å‡å°é«˜åº¦ */
            }
            
            .hamburger-icon span {
                height: 2px; /* è¶…å°å±å¹•è¿›ä¸€æ­¥å˜ç»† */
                background-color: rgba(224, 230, 239, 0.7); /* ä¿æŒé€æ˜åº¦ */
            }
        }
        
        @media (min-width: 481px) {
            .btn-group-3 button span.short-text {
                display: none;
            }
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #6a11cb;
        }
        
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid #6a11cb;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <button class="hamburger-menu-btn" id="hamburgerMenuBtn">
        <div class="hamburger-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </button>
    
    <div class="main-content" id="mainContent">
        <div class="container">
            <header>
                <h1>æ€§èƒ½å¸¦å®½è®¡ç®—å™¨</h1>
                <p class="subtitle">è¾“å…¥æ ·æœ¬æ•°æ®ï¼Œè‡ªåŠ¨è®¡ç®—å‡å€¼ã€æ ‡å‡†å·®ï¼Œç¡®å®šLã€Aã€Cã€Uå¸¦å®½åŒºé—´</p>
            </header>
            
            <main>
                <section class="card input-section">
                    <h2 class="card-title">
                        <div class="card-title-text">
                            <span>ğŸ“Š</span> æ•°æ®è¾“å…¥
                        </div>
                        <button id="modeToggleBtn" class="mode-toggle-btn small-better" title="å½“å‰æ¨¡å¼ï¼šæ•°å€¼è¶Šå°è¶Šå¥½ï¼Œç‚¹å‡»åˆ‡æ¢ä¸ºè¶Šå¤§è¶Šå¥½">
                            <span class="mode-icon">â‡…</span>
                            <span class="mode-text">å°å¥½</span>
                        </button>
                    </h2>
                    <textarea id="dataInput" placeholder="è¯·è¾“å…¥æ ·æœ¬æ•°æ®ï¼Œç”¨é€—å·ã€ç©ºæ ¼æˆ–æ¢è¡Œåˆ†éš”ã€‚ä¾‹å¦‚ï¼š4.4, 3.75, 6.23, 4.65, 4.35, 6.84, 5.5, 4.81, 4.95, 5.18"></textarea>
                    <p class="input-hint">è¯·è¾“å…¥è‡³å°‘3ä¸ªæ•°å€¼ï¼Œä»¥è®¡ç®—æœ‰æ•ˆçš„ç»Ÿè®¡ç»“æœã€‚</p>
                    
                    <div class="btn-group-3">
                        <button class="btn-primary" id="calculateBtn">
                            <span class="long-text">è®¡ç®—å¹¶ç»˜åˆ¶å›¾è¡¨</span>
                            <span class="short-text">è®¡ç®—</span>
                        </button>
                        <button class="btn-secondary" id="sampleDataBtn">
                            <span class="long-text">ä½¿ç”¨ç¤ºä¾‹æ•°æ®</span>
                            <span class="short-text">ç¤ºä¾‹</span>
                        </button>
                        <button class="btn-danger" id="clearDataBtn">
                            <span class="long-text">æ¸…é™¤å…¨éƒ¨æ•°æ®</span>
                            <span class="short-text">æ¸…é™¤</span>
                        </button>
                    </div>
                    
                    <div class="loading" id="loadingIndicator">
                        <div class="loading-spinner"></div>
                        <p>æ­£åœ¨è®¡ç®—å¹¶ç»˜åˆ¶å›¾è¡¨...</p>
                    </div>
                </section>
                
                <section class="card results-section" id="resultsCard" style="display: none;">
                    <h2 class="card-title">
                        <div class="card-title-text">
                            <span>ğŸ“ˆ</span> è®¡ç®—ç»“æœ
                        </div>
                    </h2>
                    
                    <div class="lacu-container">
                        <div class="lacu-grid">
                            <div class="lacu-box L-box">
                                <div class="lacu-label L-label">L</div>
                                <div class="lacu-range" id="lRangeDisplay">(-âˆ, 0.00]</div>
                            </div>
                            <div class="lacu-box A-box">
                                <div class="lacu-label A-label">A</div>
                                <div class="lacu-range" id="aRangeDisplay">(0.00, 0.00]</div>
                            </div>
                            <div class="lacu-box C-box">
                                <div class="lacu-label C-label">C</div>
                                <div class="lacu-range" id="cRangeDisplay">(0.00, 0.00]</div>
                            </div>
                            <div class="lacu-box U-box">
                                <div class="lacu-label U-label">U</div>
                                <div class="lacu-range" id="uRangeDisplay">(0.00, +âˆ)</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-summary">
                        <div>å‡å€¼: <span id="meanValue">0.00</span></div>
                        <div>æ ‡å‡†å·®: <span id="stdValue">0.00</span></div>
                        <div>æœ‰æ•ˆæ•°æ®: <span id="validCount">0</span>/<span id="totalCount">0</span></div>
                    </div>
                </section>
                
                <section class="card chart-section" id="chartCard" style="display: none;">
                    <h2 class="card-title">
                        <div class="card-title-text">
                            <span>ğŸ“Š</span> æ€§èƒ½å¸¦å®½åˆ†å¸ƒ
                        </div>
                        <button id="downloadChartBtn" class="download-chart-btn" title="ä¸‹è½½å›¾è¡¨å›¾ç‰‡">
                            <span class="download-icon"></span>
                        </button>
                    </h2>
                    
                    <div class="chart-container">
                        <canvas id="bandwidthChart"></canvas>
                    </div>
                    
                    <div class="note">
                        <p><strong>è¯´æ˜:</strong></p>
                        <p id="chartDescription">æŸ±çŠ¶å›¾æŒ‰æ•°æ®å€¼ä»é«˜åˆ°ä½æ’åˆ—ï¼Œä¸åŒé¢œè‰²è¡¨ç¤ºä¸åŒçš„LACUåŒºé—´ã€‚</p>
                    </div>
                </section>
                
                <section class="card lacu-definition-section">
                    <h2 class="card-title">
                        <div class="card-title-text">
                            <span>â„¹ï¸</span> LACUåŒºé—´å®šä¹‰
                        </div>
                    </h2>
                    <div class="note" id="lacuDefinition">
                        <p><strong>L (Leader):</strong> æ•°å€¼ â‰¤ å‡å€¼ - 1.25 Ã— æ ‡å‡†å·®</p>
                        <p><strong>A (Among the Leaders):</strong> å‡å€¼ - 1.25 Ã— æ ‡å‡†å·® < æ•°å€¼ â‰¤ å‡å€¼ - 0.5 Ã— æ ‡å‡†å·®</p>
                        <p><strong>C (Competitive):</strong> å‡å€¼ - 0.5 Ã— æ ‡å‡†å·® < æ•°å€¼ â‰¤ å‡å€¼ + 0.5 Ã— æ ‡å‡†å·®</p>
                        <p><strong>U (Uncompetitive):</strong> æ•°å€¼ > å‡å€¼ + 0.5 Ã— æ ‡å‡†å·®</p>
                        <p style="margin-top: 10px;"><em>æ³¨ï¼šæ ‡å‡†å·®ä½¿ç”¨æ— åä¼°è®¡å…¬å¼è®¡ç®—ï¼ˆé™¤ä»¥n-1ï¼‰</em></p>
                    </div>
                </section>
            </main>
            
            <footer class="footer">
                æ€§èƒ½å¸¦å®½è®¡ç®—å™¨ Â© 2025 | æ¨ªå±æ˜¾ç¤ºæ•ˆæœæ›´ä½³
            </footer>
        </div>
    </div>
    
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <div class="settings-title">
                âš™ï¸ è®¾ç½®
            </div>
        </div>
        
        <div class="settings-item" id="updateItem">
            <div class="item-header" id="updateHeader">
                <div class="item-content-wrapper">
                    <div class="item-icon update-icon">
                        ğŸ”„
                    </div>
                    <div class="item-text">
                        <div class="item-title">æ£€æµ‹æ›´æ–°</div>
                        <div class="item-desc">æ£€æŸ¥åº”ç”¨æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬å¯ç”¨</div>
                    </div>
                </div>
            </div>
            <div class="item-content" id="updateContent">
                <div class="content-inner">
                    <div class="update-content">
                        <div class="update-status" id="updateStatus">
                            <span>å½“å‰ç‰ˆæœ¬ï¼šv1.0.0</span>
                        </div>
                        <button class="check-update-btn" id="checkUpdateBtn">
                            <span id="updateBtnText">æ£€æŸ¥æ›´æ–°</span>
                            <span class="spinner" id="updateSpinner"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="settings-item" id="shareItem">
            <div class="item-header" id="shareHeader">
                <div class="item-content-wrapper">
                    <div class="item-icon share-icon">
                        ğŸ“¤
                    </div>
                    <div class="item-text">
                        <div class="item-title">åˆ†äº«åº”ç”¨</div>
                        <div class="item-desc">åˆ†äº«ä¸‹è½½é“¾æ¥ç»™å¥½å‹</div>
                    </div>
                </div>
            </div>
            <div class="item-content" id="shareContent">
                <div class="content-inner">
                    </div>
            </div>
        </div>
        
        <div class="settings-item" id="aboutItem">
            <div class="item-header" id="aboutHeader">
                <div class="item-content-wrapper">
                    <div class="item-icon about-icon">
                        â„¹ï¸
                    </div>
                    <div class="item-text">
                        <div class="item-title">å…³äº</div>
                        <div class="item-desc">å…³äºæ€§èƒ½å¸¦å®½è®¡ç®—å™¨çš„ä¿¡æ¯</div>
                    </div>
                </div>
            </div>
            <div class="item-content" id="aboutContent">
                <div class="content-inner">
                    <div class="about-content">
                        <p>æ€§èƒ½å¸¦å®½è®¡ç®—å™¨æ˜¯ä¸€æ¬¾ä¸“ä¸šçš„ç»Ÿè®¡åˆ†æå·¥å…·ï¼Œé€‚ç”¨äºæ€§èƒ½åˆ†æã€è´¨é‡ç®¡æ§ã€æ•°æ®è¯„ä¼°ç­‰å¤šç§åœºæ™¯ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿäº†è§£æ•°æ®åˆ†å¸ƒç‰¹å¾ã€‚</p>
                        
                        <div class="version-info">
                            <p>å½“å‰ç‰ˆæœ¬ï¼š<span class="version">v1.0.0</span></p>
                            <p>æ›´æ–°æ—¥æœŸï¼š2025å¹´12æœˆ</p> <p>å¼€å‘è€…ï¼šæ€§èƒ½å¸¦å®½è®¡ç®—å™¨å›¢é˜Ÿ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="qrcode-modal" id="qrcodeModal">
        <div class="qrcode-modal-content">
            <div class="qrcode-modal-header">
                <h3 class="qrcode-modal-title">äºŒç»´ç åˆ†äº«</h3>
                <button class="close-qrcode-modal" id="closeQrcodeModal">&times;</button>
            </div>
            <div class="qrcode-placeholder">
                <div class="qrcode-placeholder-icon">ğŸ“±</div>
                <div class="qrcode-placeholder-text">äºŒç»´ç åˆ†äº«åŠŸèƒ½<br>å½“å‰ä¸å¯ç”¨</div>
            </div>
            <p class="qrcode-hint">è¯·ä½¿ç”¨å¤åˆ¶é“¾æ¥åŠŸèƒ½åˆ†äº«åº”ç”¨</p>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let bandwidthChart = null;
        let currentData = [];
        let mean = 0;
        let std = 0;
        let isMaxBetterMode = false; // false: è¶Šå°è¶Šå¥½, true: è¶Šå¤§è¶Šå¥½
        
        // DOMå…ƒç´ 
        const dataInput = document.getElementById('dataInput');
        const calculateBtn = document.getElementById('calculateBtn');
        const sampleDataBtn = document.getElementById('sampleDataBtn');
        const clearDataBtn = document.getElementById('clearDataBtn');
        const modeToggleBtn = document.getElementById('modeToggleBtn');
        const downloadChartBtn = document.getElementById('downloadChartBtn'); // æ–°å¢
        const loadingIndicator = document.getElementById('loadingIndicator');
        const resultsCard = document.getElementById('resultsCard');
        const chartCard = document.getElementById('chartCard');
        const chartDescription = document.getElementById('chartDescription');
        const lacuDefinition = document.getElementById('lacuDefinition');
        
        // ç»“æœå…ƒç´ 
        const meanValue = document.getElementById('meanValue');
        const stdValue = document.getElementById('stdValue');
        const lRangeDisplay = document.getElementById('lRangeDisplay');
        const aRangeDisplay = document.getElementById('aRangeDisplay');
        const cRangeDisplay = document.getElementById('cRangeDisplay');
        const uRangeDisplay = document.getElementById('uRangeDisplay');
        const totalCount = document.getElementById('totalCount');
        const validCount = document.getElementById('validCount');
        
        // ç¤ºä¾‹æ•°æ® - ä¿®æ”¹ä¸ºï¼š4.4,3.75,6.23,4.65,4.35,6.84,5.5,4.81,4.95,5.18
        const sampleData = [4.4, 3.75, 6.23, 4.65, 4.35, 6.84, 5.5, 4.81, 4.95, 5.18];
        
        // è®¾ç½®é¢æ¿ç›¸å…³å…ƒç´ 
        const mainContent = document.getElementById('mainContent');
        const hamburgerMenuBtn = document.getElementById('hamburgerMenuBtn');
        const settingsPanel = document.getElementById('settingsPanel');
        
        // è®¾ç½®é¡¹å…ƒç´ 
        const updateItem = document.getElementById('updateItem');
        const shareItem = document.getElementById('shareItem');
        const aboutItem = document.getElementById('aboutItem');
        
        const updateHeader = document.getElementById('updateHeader');
        const shareHeader = document.getElementById('shareHeader');
        const aboutHeader = document.getElementById('aboutHeader');
        
        const updateContent = document.getElementById('updateContent');
        const shareContent = document.getElementById('shareContent');
        const aboutContent = document.getElementById('aboutContent');
        
        // æ£€æµ‹æ›´æ–°ç›¸å…³å…ƒç´ 
        const checkUpdateBtn = document.getElementById('checkUpdateBtn');
        const updateStatus = document.getElementById('updateStatus');
        const updateSpinner = document.getElementById('updateSpinner');
        const updateBtnText = document.getElementById('updateBtnText');
        
        // äºŒç»´ç å¼¹çª—å…ƒç´ 
        const qrcodeModal = document.getElementById('qrcodeModal');
        const closeQrcodeModal = document.getElementById('closeQrcodeModal');
        
        // æ§åˆ¶è®¾ç½®é¢æ¿æ˜¾ç¤º/éšè—
        let isSettingsOpen = false;
        let currentOpenItem = null;
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;
        
        // åˆ†äº«å†…å®¹
        const shareText = "æˆ‘æ­£åœ¨ä½¿ç”¨æ€§èƒ½å¸¦å®½è®¡ç®—å™¨ï¼Œéå¸¸å¥½ç”¨ï¼Œæ¨èç»™ä½ ä¸€èµ·ä½¿ç”¨ï¼Œè®©æ•°æ®åˆ†ææ›´ç®€å•ï¼ä¸‹è½½é“¾æ¥ï¼šhttp://141.148.180.246/app-release.apk";
        
        // åˆ›å»ºåˆ†äº«é€‰é¡¹å†…å®¹
        function createShareOptions() {
            const shareInnerHTML = `
                <div class="share-content">
                    <div class="share-hint">æ¨èç»™æœ‹å‹ä¸€èµ·ä½¿ç”¨ï¼Œè®©æ•°æ®åˆ†ææ›´ç®€å•ã€‚</div>
                    <div class="share-options">
                        <div class="share-option" id="copyLinkOption">
                            <div class="share-option-icon">ğŸ”—</div>
                            <div class="share-option-text">
                                <div class="share-option-title">å¤åˆ¶é“¾æ¥</div>
                                <div class="share-option-desc">å¤åˆ¶ä¸‹è½½é“¾æ¥</div>
                            </div>
                        </div>
                        
                        <div class="share-option" id="qrcodeShareOption">
                            <div class="share-option-icon">ğŸ“±</div>
                            <div class="share-option-text">
                                <div class="share-option-title">äºŒç»´ç åˆ†äº«</div>
                                <div class="share-option-desc">ç”ŸæˆäºŒç»´ç ä¾›å¥½å‹æ‰«æ</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="copySuccess" class="copy-success">âœ“ é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>
                </div>
            `;
            
            return shareInnerHTML;
        }
        
        // åˆå§‹åŒ–åˆ†äº«è®¾ç½®é¡¹
        function initShareSection() {
            const contentInner = shareContent.querySelector('.content-inner');
            contentInner.innerHTML = createShareOptions();
            
            // è·å–æ–°åˆ›å»ºçš„å…ƒç´ 
            const copyLinkOption = document.getElementById('copyLinkOption');
            const qrcodeShareOption = document.getElementById('qrcodeShareOption');
            const copySuccess = document.getElementById('copySuccess');
            
            // å¤åˆ¶é“¾æ¥åŠŸèƒ½
            copyLinkOption.addEventListener('click', () => {
                copyToClipboard(shareText);
                copySuccess.style.display = 'block';
                
                // 3ç§’åéšè—æˆåŠŸæç¤º
                setTimeout(() => {
                    copySuccess.style.display = 'none';
                }, 3000);
            });
            
            // äºŒç»´ç åˆ†äº«åŠŸèƒ½
            qrcodeShareOption.addEventListener('click', () => {
                openQrcodeModal();
            });
        }
        
        // åˆ‡æ¢è®¾ç½®é¢æ¿
        function toggleSettingsPanel() {
            isSettingsOpen = !isSettingsOpen;
            
            if (isSettingsOpen) {
                settingsPanel.classList.add('open');
                mainContent.classList.add('settings-open');
                hamburgerMenuBtn.style.display = 'none';
                
                // ç¦ç”¨ä¸»å†…å®¹åŒºåŸŸæ»šåŠ¨
                document.body.style.overflow = 'hidden';
            } else {
                settingsPanel.classList.remove('open');
                mainContent.classList.remove('settings-open');
                hamburgerMenuBtn.style.display = 'flex';
                
                // å¯ç”¨ä¸»å†…å®¹åŒºåŸŸæ»šåŠ¨
                document.body.style.overflow = 'auto';
            }
        }
        
        // åˆ‡æ¢è®¾ç½®é¡¹å±•å¼€/æ”¶èµ·
        function toggleItem(header, content) {
            const isActive = header.classList.contains('active');
            
            // å¦‚æœå½“å‰æœ‰å±•å¼€çš„é¡¹ç›®ï¼Œå…ˆæ”¶èµ·å®ƒ
            if (currentOpenItem && currentOpenItem !== header) {
                const currentContent = currentOpenItem.nextElementSibling;
                
                currentOpenItem.classList.remove('active');
                currentContent.classList.remove('active');
            }
            
            // åˆ‡æ¢å½“å‰é¡¹ç›®çš„çŠ¶æ€
            if (isActive) {
                // å¦‚æœæ˜¯å½“å‰é¡¹ç›®ä¸”å·²å±•å¼€ï¼Œåˆ™æ”¶èµ·
                header.classList.remove('active');
                content.classList.remove('active');
                currentOpenItem = null;
            } else {
                // å¦‚æœæœªå±•å¼€ï¼Œåˆ™å±•å¼€
                header.classList.add('active');
                content.classList.add('active');
                currentOpenItem = header;
                
                // å¦‚æœæ˜¯åˆ†äº«è®¾ç½®é¡¹ï¼Œåˆå§‹åŒ–åˆ†äº«å†…å®¹
                if (header === shareHeader) {
                    // ç¡®ä¿åˆ†äº«å†…å®¹å·²åˆå§‹åŒ–
                    if (!shareContent.querySelector('.share-options')) {
                        initShareSection();
                    }
                }
            }
        }
        
        // æ‰“å¼€äºŒç»´ç å¼¹çª—
        function openQrcodeModal() {
            qrcodeModal.style.display = 'flex';
        }
        
        // å…³é—­äºŒç»´ç å¼¹çª—
        function closeQrcodeModalFunc() {
            qrcodeModal.style.display = 'none';
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        console.log('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿:', text);
                    })
                    .catch(err => {
                        console.error('å¤åˆ¶å¤±è´¥:', err);
                        fallbackCopyText(text);
                    });
            } else {
                fallbackCopyText(text);
            }
        }
        
        // é™çº§å¤åˆ¶æ–¹æ³•
        function fallbackCopyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = 0;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (!successful) {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶å†…å®¹');
                }
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶å†…å®¹');
            }
            
            document.body.removeChild(textArea);
        }
        
        // æ£€æŸ¥æ›´æ–°åŠŸèƒ½
        checkUpdateBtn.addEventListener('click', () => {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            updateSpinner.style.display = 'inline-block';
            updateBtnText.textContent = 'æ£€æŸ¥ä¸­...';
            checkUpdateBtn.disabled = true;
            
            // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚å»¶è¿Ÿ
            setTimeout(() => {
                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º - ç®€åŒ–ç‰ˆï¼Œä¸æ˜¾ç¤ºé¢å¤–ä¿¡æ¯
                updateStatus.innerHTML = '<span style="color: #2ecc71; font-weight: bold;">å½“å‰å·²æ˜¯æœ€æ–°ç‰ˆæœ¬</span>';
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                updateSpinner.style.display = 'none';
                updateBtnText.textContent = 'æ£€æŸ¥æ›´æ–°';
                checkUpdateBtn.disabled = false;
            }, 1500);
        });
        
        // è§¦æ‘¸äº‹ä»¶å¤„ç† - ç”¨äºå·¦æ»‘å…³é—­
        function handleTouchStart(e) {
            if (!isSettingsOpen) return;
            
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }
        
        function handleTouchEnd(e) {
            if (!isSettingsOpen) return;
            
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            
            // è®¡ç®—æ»‘åŠ¨è·ç¦»
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            
            // å¦‚æœä¸»è¦æ˜¯æ°´å¹³æ»‘åŠ¨ä¸”å‘å·¦æ»‘åŠ¨è·ç¦»å¤§äº50pxï¼Œåˆ™å…³é—­è®¾ç½®é¢æ¿
            if (Math.abs(deltaX) > Math.abs(deltaY) && deltaX < -50) {
                toggleSettingsPanel();
            }
        }
        
        // ä½¿ç”¨æŒ‡å®šæ•°æ®è®¡ç®—ï¼ˆä¸ä¾èµ–è¾“å…¥æ¡†ï¼‰
        function calculateWithData(dataArray) {
            currentData = [...dataArray];
            
            // è®¡ç®—ç»Ÿè®¡å€¼
            mean = calculateMean(currentData);
            std = calculateStd(currentData, mean);
            
            // è®¡ç®—LACUè¾¹ç•Œ
            const boundaries = calculateLACUBoundaries(mean, std);
            
            // æ›´æ–°è®¡ç®—ç»“æœ
            meanValue.textContent = formatNumber(mean);
            stdValue.textContent = formatNumber(std);
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            totalCount.textContent = dataArray.length;
            validCount.textContent = currentData.length;
            
            // æ›´æ–°LACUåŒºé—´èŒƒå›´æ˜¾ç¤º
            updateLACUDisplay(boundaries);
            
            // ç¡®å®šæ¯ä¸ªæ•°æ®ç‚¹çš„LACUåŒºé—´
            const dataWithLACU = currentData.map(value => {
                const lacu = determineLACU(value, mean, std);
                return {
                    value,
                    lacu,
                    color: getLACUColor(lacu)
                };
            });
            
            // ä»é«˜åˆ°ä½æ’åºæ•°æ®
            dataWithLACU.sort((a, b) => b.value - a.value);
            
            // å‡†å¤‡å›¾è¡¨æ•°æ®
            const labels = dataWithLACU.map((_, index) => `æ•°æ®${index + 1}`);
            const values = dataWithLACU.map(item => item.value);
            const colors = dataWithLACU.map(item => item.color);
            
            // è·å–å›¾è¡¨éœ€è¦ç»˜åˆ¶çš„çº¿æ¡
            const chartLines = getChartLines(boundaries);
            
            // ç»˜åˆ¶å›¾è¡¨
            drawChart(labels, values, colors, chartLines);
            
            // æ˜¾ç¤ºç»“æœå¡ç‰‡
            resultsCard.style.display = 'block';
            chartCard.style.display = 'block';
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®è¾“å…¥æ¡†ä¸ºplaceholderæ¨¡å¼ï¼Œä½†ä½¿ç”¨valueä»¥ä¾¿ç”¨æˆ·å¯ä»¥ç«‹å³è¾“å…¥
            dataInput.value = "è¯·è¾“å…¥æ ·æœ¬æ•°æ®ï¼Œç”¨é€—å·ã€ç©ºæ ¼æˆ–æ¢è¡Œåˆ†éš”ã€‚ä¾‹å¦‚ï¼š4.4, 3.75, 6.23, 4.65, 4.35, 6.84, 5.5, 4.81, 4.95, 5.18";
            dataInput.classList.add('placeholder-text'); // æ·»åŠ æµ…è‰²æ–‡æœ¬æ ·å¼
            
            // æ·»åŠ ç„¦ç‚¹äº‹ä»¶å¤„ç†ï¼Œå®ç°placeholderæ•ˆæœä½†å…è®¸ç«‹å³è¾“å…¥
            dataInput.addEventListener('focus', function() {
                if (this.value === "è¯·è¾“å…¥æ ·æœ¬æ•°æ®ï¼Œç”¨é€—å·ã€ç©ºæ ¼æˆ–æ¢è¡Œåˆ†éš”ã€‚ä¾‹å¦‚ï¼š4.4, 3.75, 6.23, 4.65, 4.35, 6.84, 5.5, 4.81, 4.95, 5.18") {
                    this.value = '';
                    this.classList.remove('placeholder-text'); // ç§»é™¤æµ…è‰²æ–‡æœ¬æ ·å¼
                }
            });
            
            // æ·»åŠ å¤±å»ç„¦ç‚¹äº‹ä»¶ï¼Œå¦‚æœä¸ºç©ºåˆ™æ¢å¤æç¤º
            dataInput.addEventListener('blur', function() {
                if (this.value.trim() === '') {
                    this.value = "è¯·è¾“å…¥æ ·æœ¬æ•°æ®ï¼Œç”¨é€—å·ã€ç©ºæ ¼æˆ–æ¢è¡Œåˆ†éš”ã€‚ä¾‹å¦‚ï¼š4.4, 3.75, 6.23, 4.65, 4.35, 6.84, 5.5, 4.81, 4.95, 5.18";
                    this.classList.add('placeholder-text'); // æ·»åŠ æµ…è‰²æ–‡æœ¬æ ·å¼
                }
            });
            
            // æ·»åŠ inputäº‹ä»¶ç›‘å¬ï¼Œç¡®ä¿å¦‚æœè¾“å…¥æ¡†å†…å®¹ä¸æ˜¯æç¤ºæ–‡æœ¬ï¼Œåˆ™ç§»é™¤placeholder-textç±»
            dataInput.addEventListener('input', function() {
                // å¦‚æœå½“å‰æ˜¯æç¤ºæ–‡æœ¬ï¼Œåœ¨inputäº‹ä»¶ä¸­æˆ‘ä»¬å·²ç»æ¸…ç©ºäº†ï¼Œæ‰€ä»¥è¿™é‡Œåˆ¤æ–­å¦‚æœä¸æ˜¯æç¤ºæ–‡æœ¬ï¼Œå°±ç§»é™¤ç±»
                if (this.value !== "è¯·è¾“å…¥æ ·æœ¬æ•°æ®ï¼Œç”¨é€—å·ã€ç©ºæ ¼æˆ–æ¢è¡Œåˆ†éš”ã€‚ä¾‹å¦‚ï¼š4.4, 3.75, 6.23, 4.65, 4.35, 6.84, 5.5, 4.81, 4.95, 5.18") {
                    this.classList.remove('placeholder-text');
                }
            });
            
            // åˆå§‹åŒ–æ¨¡å¼æŒ‰é’®å’ŒLACUå®šä¹‰æ˜¾ç¤º
            updateModeButton(); // æ–°å¢ï¼šåˆå§‹åŒ–æ¨¡å¼æŒ‰é’®æ˜¾ç¤º
            updateLACUDefinition(); // æ–°å¢ï¼šåˆå§‹åŒ–LACUå®šä¹‰æ˜¾ç¤º
            
            // äº‹ä»¶ç›‘å¬
            calculateBtn.addEventListener('click', calculateAndPlot);
            sampleDataBtn.addEventListener('click', () => {
                dataInput.value = sampleData.join(', ');
                dataInput.classList.remove('placeholder-text'); // ç§»é™¤æµ…è‰²æ–‡æœ¬æ ·å¼
                calculateAndPlot();
            });
            clearDataBtn.addEventListener('click', () => {
                dataInput.value = "è¯·è¾“å…¥æ ·æœ¬æ•°æ®ï¼Œç”¨é€—å·ã€ç©ºæ ¼æˆ–æ¢è¡Œåˆ†éš”ã€‚ä¾‹å¦‚ï¼š4.4, 3.75, 6.23, 4.65, 4.35, 6.84, 5.5, 4.81, 4.95, 5.18";
                dataInput.classList.add('placeholder-text'); // æ·»åŠ æµ…è‰²æ–‡æœ¬æ ·å¼
            });
            
            // æ¨¡å¼åˆ‡æ¢ç›‘å¬
            modeToggleBtn.addEventListener('click', function() {
                isMaxBetterMode = !isMaxBetterMode;
                updateModeButton();
                updateLACUDefinition();
                
                // å¦‚æœæœ‰å½“å‰æ•°æ®ï¼Œé‡æ–°è®¡ç®—
                if (currentData.length > 0) {
                    calculateAndPlot();
                }
            });
            
            // å›¾è¡¨ä¸‹è½½æŒ‰é’®ç›‘å¬ - ä½¿ç”¨ä¿®å¤åçš„å‡½æ•°
            downloadChartBtn.addEventListener('click', downloadChartImage);
            
            // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
            dataInput.addEventListener('input', autoResizeTextarea);
            
            // åˆå§‹è®¡ç®— - ä½¿ç”¨ç¤ºä¾‹æ•°æ®ä½†ä¸æ˜¾ç¤ºåœ¨è¾“å…¥æ¡†
            setTimeout(() => {
                // ç›´æ¥ä½¿ç”¨ç¤ºä¾‹æ•°æ®è®¡ç®—
                calculateWithData(sampleData);
            }, 500);
            
            // è®¾ç½®é¢æ¿ç›¸å…³äº‹ä»¶ç›‘å¬
            hamburgerMenuBtn.addEventListener('click', toggleSettingsPanel);
            closeQrcodeModal.addEventListener('click', closeQrcodeModalFunc);
            
            // ç‚¹å‡»å³ä¾§ä»»æ„ä½ç½®å…³é—­è®¾ç½®é¢æ¿
            mainContent.addEventListener('click', (e) => {
                if (isSettingsOpen && !e.target.closest('.settings-panel')) {
                    toggleSettingsPanel();
                }
            });
            
            // è§¦æ‘¸äº‹ä»¶ç›‘å¬
            mainContent.addEventListener('touchstart', handleTouchStart);
            mainContent.addEventListener('touchend', handleTouchEnd);
            
            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            window.addEventListener('click', (event) => {
                if (event.target === qrcodeModal) {
                    closeQrcodeModalFunc();
                }
            });
            
            // è®¾ç½®é¡¹ç‚¹å‡»äº‹ä»¶
            updateHeader.addEventListener('click', () => {
                toggleItem(updateHeader, updateContent);
            });
            
            shareHeader.addEventListener('click', () => {
                toggleItem(shareHeader, shareContent);
            });
            
            aboutHeader.addEventListener('click', () => {
                toggleItem(aboutHeader, aboutContent);
            });
            
            // é»˜è®¤ä¸å±•å¼€ä»»ä½•è®¾ç½®é¡¹
            currentOpenItem = null;
            
            // åˆå§‹åŒ–åˆ†äº«è®¾ç½®é¡¹
            initShareSection();
        });
        
        // ä¸‹è½½å›¾è¡¨å›¾ç‰‡ - ä¿®å¤ç‰ˆï¼šAppç¯å¢ƒä½¿ç”¨plus.galleryä¿å­˜
        function downloadChartImage() {
            if (!bandwidthChart) {
                alert('è¯·å…ˆç”Ÿæˆå›¾è¡¨');
                return;
            }
            
            try {
                // è·å–å›¾è¡¨Canvaså…ƒç´ 
                const canvas = document.getElementById('bandwidthChart');
                
                // åˆ›å»ºä¸€ä¸ªæ–°çš„Canvasç”¨äºæ·»åŠ è¡¨å¤´
                const newCanvas = document.createElement('canvas');
                const ctx = newCanvas.getContext('2d');
                
                // åŠ¨æ€è®¡ç®—å­—ä½“å¤§å°ï¼Œæ ¹æ®å›¾è¡¨å®½åº¦è°ƒæ•´
                const chartWidth = canvas.width;
                let titleFontSize, subtitleFontSize, paddingTop;
                
                if (chartWidth < 500) {
                    // å°å°ºå¯¸å›¾è¡¨
                    titleFontSize = 22;
                    subtitleFontSize = 14;
                    paddingTop = 70;
                } else if (chartWidth < 800) {
                    // ä¸­ç­‰å°ºå¯¸å›¾è¡¨
                    titleFontSize = 26;
                    subtitleFontSize = 15;
                    paddingTop = 75;
                } else {
                    // å¤§å°ºå¯¸å›¾è¡¨
                    titleFontSize = 30;
                    subtitleFontSize = 16;
                    paddingTop = 80;
                }
                
                // è®¾ç½®æ–°Canvasçš„å°ºå¯¸ï¼ˆåŸCanvaså®½åº¦ä¸å˜ï¼Œé«˜åº¦å¢åŠ ç”¨äºè¡¨å¤´ï¼‰
                newCanvas.width = canvas.width;
                newCanvas.height = canvas.height + paddingTop;
                
                // ç»˜åˆ¶èƒŒæ™¯è‰²
                ctx.fillStyle = '#1e2430';
                ctx.fillRect(0, 0, newCanvas.width, newCanvas.height);
                
                // ç»˜åˆ¶è¡¨å¤´
                ctx.fillStyle = '#e0e6ef';
                ctx.font = `bold ${titleFontSize}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('æ€§èƒ½å¸¦å®½åˆ†å¸ƒå›¾', newCanvas.width / 2, paddingTop / 2 - 10);
                
                // ç»˜åˆ¶åˆ†éš”çº¿
                ctx.beginPath();
                ctx.moveTo(newCanvas.width * 0.2, paddingTop / 2 + 5); // ä»20%å®½åº¦å¼€å§‹
                ctx.lineTo(newCanvas.width * 0.8, paddingTop / 2 + 5); // åˆ°80%å®½åº¦ç»“æŸ
                ctx.strokeStyle = '#3a4255';
                ctx.lineWidth = 1;
                ctx.stroke();
                
                // æ·»åŠ å‰¯æ ‡é¢˜ï¼ˆåŒ…å«ç»Ÿè®¡ä¿¡æ¯ï¼‰
                ctx.font = `bold ${subtitleFontSize}px Arial`;
                ctx.fillStyle = '#a0a6b0';
                ctx.fillText(
                    `å‡å€¼: ${meanValue.textContent} | æ ‡å‡†å·®: ${stdValue.textContent} | æ¨¡å¼: ${isMaxBetterMode ? 'è¶Šå¤§è¶Šå¥½' : 'è¶Šå°è¶Šå¥½'}`,
                    newCanvas.width / 2,
                    paddingTop / 2 + 25
                );
                
                // å°†åŸå›¾è¡¨ç»˜åˆ¶åˆ°æ–°Canvasä¸Šï¼ˆå‘ä¸‹åç§»ï¼‰
                ctx.drawImage(canvas, 0, paddingTop);
                
                // ç”Ÿæˆæ–‡ä»¶åï¼ŒåŒ…å«å½“å‰æ—¥æœŸ
                const now = new Date();
                const dateStr = now.toISOString().split('T')[0];
                const timeStr = now.getHours().toString().padStart(2, '0') + 
                               now.getMinutes().toString().padStart(2, '0');
                const filename = `æ€§èƒ½å¸¦å®½åˆ†å¸ƒå›¾_${dateStr}_${timeStr}.png`;
                const base64Data = newCanvas.toDataURL('image/png');

                // åˆ¤æ–­è¿è¡Œç¯å¢ƒï¼šå¦‚æœæ˜¯Appç¯å¢ƒ (window.pluså­˜åœ¨)ï¼Œåˆ™ä½¿ç”¨Nativeæ–¹æ³•ä¿å­˜
                if (window.plus) {
                    saveImageToGallery(base64Data, filename);
                } else {
                    // æµè§ˆå™¨ç¯å¢ƒï¼šåˆ›å»ºä¸´æ—¶é“¾æ¥ä¸‹è½½
                    const link = document.createElement('a');
                    link.download = filename;
                    link.href = base64Data;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    console.log('å›¾è¡¨å·²ä¸‹è½½:', filename);
                }
            } catch (error) {
                console.error('ä¸‹è½½å›¾è¡¨æ—¶å‡ºé”™:', error);
                alert('ä¸‹è½½å›¾è¡¨æ—¶å‡ºé”™ï¼Œè¯·é‡è¯•');
            }
        }

        // æ–°å¢ï¼šAppç«¯ä¿å­˜å›¾ç‰‡åˆ°ç›¸å†Œçš„å‡½æ•°
        function saveImageToGallery(base64Data, filename) {
            // åˆ›å»ºåŸç”Ÿ Bitmap å¯¹è±¡
            var bitmap = new plus.nativeObj.Bitmap("chart_img");
            
            // åŠ è½½ Base64 æ•°æ®
            bitmap.loadBase64Data(base64Data, function() {
                console.log("åŠ è½½Base64å›¾ç‰‡æ•°æ®æˆåŠŸ");
                
                // å®šä¹‰ä¸´æ—¶ä¿å­˜è·¯å¾„ (ç§æœ‰æ–‡æ¡£ç›®å½•)
                var url = "_doc/" + filename;
                
                // ä¿å­˜åˆ°ç§æœ‰ç›®å½•
                bitmap.save(url, { overwrite: true, format: 'png' }, function(i) {
                    console.log('ä¿å­˜å›¾ç‰‡åˆ°_docæˆåŠŸï¼š' + JSON.stringify(i));
                    
                    // ä¿å­˜åˆ°ç³»ç»Ÿç›¸å†Œ
                    plus.gallery.save(url, function(e) {
                        // æˆåŠŸå›è°ƒ
                        plus.nativeUI.toast("å›¾ç‰‡å·²ä¿å­˜åˆ°ç³»ç»Ÿç›¸å†Œ", {duration: "long"});
                        bitmap.clear(); // é”€æ¯ä½å›¾é‡Šæ”¾å†…å­˜
                    }, function(e) {
                        // å¤±è´¥å›è°ƒ
                        plus.nativeUI.toast("ä¿å­˜åˆ°ç›¸å†Œå¤±è´¥: " + JSON.stringify(e));
                        console.log("ä¿å­˜åˆ°ç›¸å†Œå¤±è´¥: " + JSON.stringify(e));
                        bitmap.clear();
                    });
                    
                }, function(e) {
                    console.log('ä¿å­˜å›¾ç‰‡å¤±è´¥ï¼š' + JSON.stringify(e));
                    plus.nativeUI.toast("ä¿å­˜å›¾ç‰‡å¤±è´¥");
                    bitmap.clear();
                });
                
            }, function(e) {
                console.log('åŠ è½½å›¾ç‰‡æ•°æ®å¤±è´¥ï¼š' + JSON.stringify(e));
                plus.nativeUI.toast("åŠ è½½å›¾ç‰‡æ•°æ®å¤±è´¥");
                bitmap.clear();
            });
        }
        
        // æ›´æ–°æ¨¡å¼æŒ‰é’®
        function updateModeButton() {
            const modeIcon = modeToggleBtn.querySelector('.mode-icon');
            const modeText = modeToggleBtn.querySelector('.mode-text');
            
            if (isMaxBetterMode) {
                // è¶Šå¤§è¶Šå¥½æ¨¡å¼
                modeIcon.textContent = 'â‡…';
                modeText.textContent = 'å¤§å¥½';
                modeToggleBtn.title = "å½“å‰æ¨¡å¼ï¼šæ•°å€¼è¶Šå¤§è¶Šå¥½ï¼Œç‚¹å‡»åˆ‡æ¢ä¸ºè¶Šå°è¶Šå¥½";
                modeToggleBtn.classList.remove('small-better');
                modeToggleBtn.classList.add('large-better');
                chartDescription.textContent = "æŸ±çŠ¶å›¾æŒ‰æ•°æ®å€¼ä»é«˜åˆ°ä½æ’åˆ—ï¼Œä¸åŒé¢œè‰²è¡¨ç¤ºä¸åŒçš„LACUåŒºé—´ã€‚";
            } else {
                // è¶Šå°è¶Šå¥½æ¨¡å¼
                modeIcon.textContent = 'â‡…';
                modeText.textContent = 'å°å¥½';
                modeToggleBtn.title = "å½“å‰æ¨¡å¼ï¼šæ•°å€¼è¶Šå°è¶Šå¥½ï¼Œç‚¹å‡»åˆ‡æ¢ä¸ºè¶Šå¤§è¶Šå¥½";
                modeToggleBtn.classList.remove('large-better');
                modeToggleBtn.classList.add('small-better');
                chartDescription.textContent = "æŸ±çŠ¶å›¾æŒ‰æ•°æ®å€¼ä»é«˜åˆ°ä½æ’åˆ—ï¼Œä¸åŒé¢œè‰²è¡¨ç¤ºä¸åŒçš„LACUåŒºé—´ã€‚";
            }
        }
        
        // æ›´æ–°LACUå®šä¹‰
        function updateLACUDefinition() {
            let modeHint = '';
            if (isMaxBetterMode) {
                modeHint = '<p class="current-mode-hint">å½“å‰æ¨¡å¼ï¼šæ•°å€¼è¶Šå¤§è¶Šå¥½</p>';
                lacuDefinition.innerHTML = modeHint + `
                    <p><strong>L (Leader):</strong> æ•°å€¼ â‰¥ å‡å€¼ + 1.25 Ã— æ ‡å‡†å·®</p>
                    <p><strong>A (Among the Leaders):</strong> å‡å€¼ + 0.5 Ã— æ ‡å‡†å·® â‰¤ æ•°å€¼ < å‡å€¼ + 1.25 Ã— æ ‡å‡†å·®</p>
                    <p><strong>C (Competitive):</strong> å‡å€¼ - 0.5 Ã— æ ‡å‡†å·® â‰¤ æ•°å€¼ < å‡å€¼ + 0.5 Ã— æ ‡å‡†å·®</p>
                    <p><strong>U (Uncompetitive):</strong> æ•°å€¼ < å‡å€¼ - 0.5 Ã— æ ‡å‡†å·®</p>
                    <p style="margin-top: 10px;"><em>æ³¨ï¼šæ ‡å‡†å·®ä½¿ç”¨æ— åä¼°è®¡å…¬å¼è®¡ç®—ï¼ˆé™¤ä»¥n-1ï¼‰</em></p>
                `;
            } else {
                modeHint = '<p class="current-mode-hint">å½“å‰æ¨¡å¼ï¼šæ•°å€¼è¶Šå°è¶Šå¥½</p>';
                lacuDefinition.innerHTML = modeHint + `
                    <p><strong>L (Leader):</strong> æ•°å€¼ â‰¤ å‡å€¼ - 1.25 Ã— æ ‡å‡†å·®</p>
                    <p><strong>A (Among the Leaders):</strong> å‡å€¼ - 1.25 Ã— æ ‡å‡†å·® < æ•°å€¼ â‰¤ å‡å€¼ - 0.5 Ã— æ ‡å‡†å·®</p>
                    <p><strong>C (Competitive):</strong> å‡å€¼ - 0.5 Ã— æ ‡å‡†å·® < æ•°å€¼ â‰¤ å‡å€¼ + 0.5 Ã— æ ‡å‡†å·®</p>
                    <p><strong>U (Uncompetitive):</strong> æ•°å€¼ > å‡å€¼ + 0.5 Ã— æ ‡å‡†å·®</p>
                    <p style="margin-top: 10px;"><em>æ³¨ï¼šæ ‡å‡†å·®ä½¿ç”¨æ— åä¼°è®¡å…¬å¼è®¡ç®—ï¼ˆé™¤ä»¥n-1ï¼‰</em></p>
                `;
            }
        }
        
        // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
        function autoResizeTextarea() {
            const textarea = dataInput;
            textarea.style.height = 'auto';
            const newHeight = Math.min(textarea.scrollHeight, 300);
            textarea.style.height = newHeight + 'px';
        }
        
        // è§£æè¾“å…¥æ•°æ® - è¿”å›æœ‰æ•ˆæ•°å­—æ•°ç»„
        function parseInputData(input) {
            // æ£€æŸ¥æ˜¯å¦æ˜¯æç¤ºæ–‡æœ¬
            if (input === "è¯·è¾“å…¥æ ·æœ¬æ•°æ®ï¼Œç”¨é€—å·ã€ç©ºæ ¼æˆ–æ¢è¡Œåˆ†éš”ã€‚ä¾‹å¦‚ï¼š4.4, 3.75, 6.23, 4.65, 4.35, 6.84, 5.5, 4.81, 4.95, 5.18") {
                return [];
            }
            
            const cleanedInput = input.replace(/ï¼Œ/g, ',').replace(/\s+/g, ',');
            const parts = cleanedInput.split(',');
            
            const numbers = parts
                .map(part => parseFloat(part.trim()))
                .filter(num => !isNaN(num) && isFinite(num));
                
            return numbers;
        }
        
        // ç»Ÿè®¡è¾“å…¥æ•°æ®çš„æ€»æ•°ï¼ˆåŒ…æ‹¬æ— æ•ˆæ•°æ®ï¼‰
        function countTotalData(input) {
            // æ£€æŸ¥æ˜¯å¦æ˜¯æç¤ºæ–‡æœ¬
            if (input === "è¯·è¾“å…¥æ ·æœ¬æ•°æ®ï¼Œç”¨é€—å·ã€ç©ºæ ¼æˆ–æ¢è¡Œåˆ†éš”ã€‚ä¾‹å¦‚ï¼š4.4, 3.75, 6.23, 4.65, 4.35, 6.84, 5.5, 4.81, 4.95, 5.18") {
                return 0;
            }
            
            if (!input.trim()) return 0;
            
            // æ›¿æ¢ä¸­æ–‡é€—å·ä¸ºè‹±æ–‡é€—å·
            let cleanedInput = input.replace(/ï¼Œ/g, ',');
            
            // å°†è¿ç»­çš„ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€æ¢è¡Œã€åˆ¶è¡¨ç¬¦ç­‰ï¼‰æ›¿æ¢ä¸ºé€—å·
            cleanedInput = cleanedInput.replace(/\s+/g, ',');
            
            // æŒ‰é€—å·åˆ†å‰²
            const parts = cleanedInput.split(',');
            
            // è¿‡æ»¤æ‰ç©ºå­—ç¬¦ä¸²ï¼ˆç”±è¿ç»­é€—å·äº§ç”Ÿï¼‰
            const nonEmptyParts = parts.filter(part => part.trim() !== '');
            
            return nonEmptyParts.length;
        }
        
        // è®¡ç®—å‡å€¼
        function calculateMean(data) {
            const sum = data.reduce((acc, val) => acc + val, 0);
            return sum / data.length;
        }
        
        // è®¡ç®—æ ·æœ¬æ ‡å‡†å·®
        function calculateStd(data, mean) {
            if (data.length < 2) return 0;
            
            const squaredDiffs = data.map(val => Math.pow(val - mean, 2));
            const sumSquaredDiffs = squaredDiffs.reduce((acc, val) => acc + val, 0);
            return Math.sqrt(sumSquaredDiffs / (data.length - 1));
        }
        
        // ç¡®å®šLACUåŒºé—´
        function determineLACU(value, mean, std) {
            if (isMaxBetterMode) {
                // è¶Šå¤§è¶Šå¥½æ¨¡å¼
                const uUpper = mean - 0.5 * std;      // UåŒºé—´çš„ä¸Šç•Œï¼ŒCåŒºé—´çš„ä¸‹ç•Œ
                const cUpper = mean + 0.5 * std;      // CåŒºé—´çš„ä¸Šç•Œï¼ŒAåŒºé—´çš„ä¸‹ç•Œ
                const aUpper = mean + 1.25 * std;     // AåŒºé—´çš„ä¸Šç•Œï¼ŒLåŒºé—´çš„ä¸‹ç•Œ
                
                if (value >= aUpper) return 'L';
                if (value >= cUpper && value < aUpper) return 'A';
                if (value >= uUpper && value < cUpper) return 'C';
                return 'U'; // value < uUpper
            } else {
                // è¶Šå°è¶Šå¥½æ¨¡å¼ï¼ˆåŸæ¨¡å¼ï¼‰
                const lUpper = mean - 1.25 * std;     // LåŒºé—´çš„ä¸Šç•Œï¼ŒAåŒºé—´çš„ä¸‹ç•Œ
                const aUpper = mean - 0.5 * std;      // AåŒºé—´çš„ä¸Šç•Œï¼ŒCåŒºé—´çš„ä¸‹ç•Œ
                const cUpper = mean + 0.5 * std;      // CåŒºé—´çš„ä¸Šç•Œï¼ŒUåŒºé—´çš„ä¸‹ç•Œ
                
                if (value <= lUpper) return 'L';
                if (value > lUpper && value <= aUpper) return 'A';
                if (value > aUpper && value <= cUpper) return 'C';
                return 'U'; // value > cUpper
            }
        }
        
        // è·å–åŒºé—´é¢œè‰²
        function getLACUColor(lacu) {
            switch(lacu) {
                case 'L': return '#e74c3c';
                case 'A': return '#f39c12';
                case 'C': return '#2ecc71';
                case 'U': return '#3498db';
                default: return '#95a5a6';
            }
        }
        
        // è®¡ç®—LACUè¾¹ç•Œå€¼
        function calculateLACUBoundaries(mean, std) {
            if (isMaxBetterMode) {
                // è¶Šå¤§è¶Šå¥½æ¨¡å¼
                return {
                    lLower: mean + 1.25 * std,    // LåŒºé—´çš„ä¸‹ç•Œ
                    aLower: mean + 0.5 * std,     // AåŒºé—´çš„ä¸‹ç•Œ
                    aUpper: mean + 1.25 * std,    // AåŒºé—´çš„ä¸Šç•Œ
                    cLower: mean - 0.5 * std,     // CåŒºé—´çš„ä¸‹ç•Œ
                    cUpper: mean + 0.5 * std,     // CåŒºé—´çš„ä¸Šç•Œ
                    uUpper: mean - 0.5 * std      // UåŒºé—´çš„ä¸Šç•Œ
                };
            } else {
                // è¶Šå°è¶Šå¥½æ¨¡å¼
                return {
                    lUpper: mean - 1.25 * std,    // LåŒºé—´çš„ä¸Šç•Œ
                    aLower: mean - 1.25 * std,    // AåŒºé—´çš„ä¸‹ç•Œ
                    aUpper: mean - 0.5 * std,     // AåŒºé—´çš„ä¸Šç•Œ
                    cLower: mean - 0.5 * std,     // CåŒºé—´çš„ä¸‹ç•Œ
                    cUpper: mean + 0.5 * std,     // CåŒºé—´çš„ä¸Šç•Œ
                    uLower: mean + 0.5 * std      // UåŒºé—´çš„ä¸‹ç•Œ
                };
            }
        }
        
        // æ›´æ–°LACUåŒºé—´æ˜¾ç¤º
        function updateLACUDisplay(boundaries) {
            if (isMaxBetterMode) {
                // è¶Šå¤§è¶Šå¥½æ¨¡å¼æ˜¾ç¤º
                lRangeDisplay.textContent = `[${boundaries.lLower.toFixed(2)}, +âˆ)`;
                aRangeDisplay.textContent = `[${boundaries.aLower.toFixed(2)}, ${boundaries.aUpper.toFixed(2)})`;
                cRangeDisplay.textContent = `[${boundaries.cLower.toFixed(2)}, ${boundaries.cUpper.toFixed(2)})`;
                uRangeDisplay.textContent = `(-âˆ, ${boundaries.uUpper.toFixed(2)})`;
            } else {
                // è¶Šå°è¶Šå¥½æ¨¡å¼æ˜¾ç¤º
                lRangeDisplay.textContent = `(-âˆ, ${boundaries.lUpper.toFixed(2)}]`;
                aRangeDisplay.textContent = `(${boundaries.aLower.toFixed(2)}, ${boundaries.aUpper.toFixed(2)}]`;
                cRangeDisplay.textContent = `(${boundaries.cLower.toFixed(2)}, ${boundaries.cUpper.toFixed(2)}]`;
                uRangeDisplay.textContent = `(${boundaries.uLower.toFixed(2)}, +âˆ)`;
            }
        }
        
        // è·å–å›¾è¡¨ä¸­éœ€è¦ç»˜åˆ¶çš„LACçº¿
        function getChartLines(boundaries) {
            if (isMaxBetterMode) {
                // è¶Šå¤§è¶Šå¥½æ¨¡å¼ï¼šç»˜åˆ¶CåŒºé—´çš„ä¸‹ç•Œã€AåŒºé—´çš„ä¸‹ç•Œã€LåŒºé—´çš„ä¸‹ç•Œ
                // è¿™äº›çº¿å¯¹åº”å„ä¸ªåŒºé—´çš„ä¸‹ç•Œï¼Œç”¨äºåˆ¤æ–­æ•°æ®ç‚¹å±äºå“ªä¸ªåŒºé—´
                return [
                    { value: boundaries.cLower, color: '#2ecc71', label: 'C', lightColor: 'rgba(46, 204, 113, 0.2)' },
                    { value: boundaries.aLower, color: '#f39c12', label: 'A', lightColor: 'rgba(243, 156, 18, 0.2)' },
                    { value: boundaries.lLower, color: '#e74c3c', label: 'L', lightColor: 'rgba(231, 76, 60, 0.2)' }
                ].sort((a, b) => a.value - b.value); // ä»ä½åˆ°é«˜æ’åº
            } else {
                // è¶Šå°è¶Šå¥½æ¨¡å¼ï¼šç»˜åˆ¶LåŒºé—´çš„ä¸Šç•Œã€AåŒºé—´çš„ä¸Šç•Œã€CåŒºé—´çš„ä¸Šç•Œ
                // è¿™äº›çº¿å¯¹åº”å„ä¸ªåŒºé—´çš„ä¸Šç•Œï¼Œç”¨äºåˆ¤æ–­æ•°æ®ç‚¹å±äºå“ªä¸ªåŒºé—´
                return [
                    { value: boundaries.lUpper, color: '#e74c3c', label: 'L', lightColor: 'rgba(231, 76, 60, 0.2)' },
                    { value: boundaries.aUpper, color: '#f39c12', label: 'A', lightColor: 'rgba(243, 156, 18, 0.2)' },
                    { value: boundaries.cUpper, color: '#2ecc71', label: 'C', lightColor: 'rgba(46, 204, 113, 0.2)' }
                ].sort((a, b) => a.value - b.value); // ä»ä½åˆ°é«˜æ’åº
            }
        }
        
        // æ ¼å¼åŒ–æ•°å€¼ï¼Œå¦‚æœå°æ•°éƒ¨åˆ†ä¸º0åˆ™ä¸æ˜¾ç¤ºå°æ•°éƒ¨åˆ†
        function formatNumber(value) {
            // æ£€æŸ¥æ˜¯å¦ä¸ºæ•´æ•°æˆ–å°æ•°éƒ¨åˆ†ä¸º0
            if (Number.isInteger(value)) {
                return value.toString();
            }
            
            // è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ£€æŸ¥å°æ•°éƒ¨åˆ†æ˜¯å¦éƒ½æ˜¯0
            const str = value.toString();
            const parts = str.split('.');
            
            if (parts.length === 2) {
                // æ£€æŸ¥å°æ•°éƒ¨åˆ†æ˜¯å¦å…¨æ˜¯0
                if (/^0+$/.test(parts[1])) {
                    return parts[0]; // è¿”å›æ•´æ•°éƒ¨åˆ†
                }
                // å»æ‰æœ«å°¾çš„0
                return value.toFixed(2).replace(/(\.\d*?)0+$/, '$1').replace(/\.$/, '');
            }
            
            return str;
        }
        
        // ä¼˜åŒ–åçš„Yè½´æ­¥é•¿è®¡ç®—å‡½æ•°ï¼Œä¿æŒä¸€è‡´çš„åˆ»åº¦æ¢¯åº¦
        function calculateStepSize(range) {
            // æ ‡å‡†åˆ»åº¦åºåˆ—ï¼š0.05, 0.1, 0.25, 0.5, 1, 2, 5, 10, 20, 50, 100, ...
            const standardSteps = [0.05, 0.1, 0.25, 0.5, 1, 2, 5, 10, 20, 50, 100];
            
            // è®¡ç®—ç†æƒ³æ­¥é•¿ï¼ˆèŒƒå›´é™¤ä»¥8-12ä¸ªåˆ»åº¦ï¼‰
            const idealStep = range / 10;
            
            // æ‰¾åˆ°æœ€æ¥è¿‘çš„æ ‡å‡†æ­¥é•¿
            for (let i = 0; i < standardSteps.length; i++) {
                if (standardSteps[i] >= idealStep) {
                    return standardSteps[i];
                }
            }
            
            // å¦‚æœèŒƒå›´å¾ˆå¤§ï¼Œä½¿ç”¨æ›´å¤§çš„æ­¥é•¿
            return Math.ceil(range / 10);
        }
        
        // è®¡ç®—å¹¶ç»˜åˆ¶å›¾è¡¨
        function calculateAndPlot() {
            // è§£æè¾“å…¥æ•°æ®
            const inputData = parseInputData(dataInput.value);
            
            // æ£€æŸ¥æ•°æ®æœ‰æ•ˆæ€§
            if (inputData.length < 3) {
                alert('è¯·è¾“å…¥è‡³å°‘3ä¸ªæœ‰æ•ˆæ•°å€¼');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
            loadingIndicator.style.display = 'block';
            resultsCard.style.display = 'none';
            chartCard.style.display = 'none';
            
            // ä½¿ç”¨setTimeoutè®©UIæœ‰æœºä¼šæ›´æ–°
            setTimeout(() => {
                try {
                    // ä¿å­˜å½“å‰æ•°æ®
                    currentData = [...inputData];
                    
                    // è®¡ç®—ç»Ÿè®¡å€¼
                    mean = calculateMean(currentData);
                    std = calculateStd(currentData, mean);
                    
                    // è®¡ç®—LACUè¾¹ç•Œ
                    const boundaries = calculateLACUBoundaries(mean, std);
                    
                    // æ›´æ–°è®¡ç®—ç»“æœ
                    meanValue.textContent = formatNumber(mean);
                    stdValue.textContent = formatNumber(std);
                    
                    // ä¿®å¤ï¼šä½¿ç”¨æ–°çš„countTotalDataå‡½æ•°ç»Ÿè®¡æ€»æ•°
                    const totalDataCount = countTotalData(dataInput.value);
                    totalCount.textContent = totalDataCount;
                    validCount.textContent = currentData.length;
                    
                    // æ›´æ–°LACUåŒºé—´èŒƒå›´æ˜¾ç¤º
                    updateLACUDisplay(boundaries);
                    
                    // ç¡®å®šæ¯ä¸ªæ•°æ®ç‚¹çš„LACUåŒºé—´
                    const dataWithLACU = currentData.map(value => {
                        const lacu = determineLACU(value, mean, std);
                        return {
                            value,
                            lacu,
                            color: getLACUColor(lacu)
                        };
                    });
                    
                    // ä»é«˜åˆ°ä½æ’åºæ•°æ®
                    dataWithLACU.sort((a, b) => b.value - a.value);
                    
                    // å‡†å¤‡å›¾è¡¨æ•°æ®
                    const labels = dataWithLACU.map((_, index) => `æ•°æ®${index + 1}`);
                    const values = dataWithLACU.map(item => item.value);
                    const colors = dataWithLACU.map(item => item.color);
                    
                    // è·å–å›¾è¡¨éœ€è¦ç»˜åˆ¶çš„çº¿æ¡
                    const chartLines = getChartLines(boundaries);
                    
                    // ç»˜åˆ¶å›¾è¡¨
                    drawChart(labels, values, colors, chartLines);
                    
                    // éšè—åŠ è½½æŒ‡ç¤ºå™¨ï¼Œæ˜¾ç¤ºç»“æœ
                    loadingIndicator.style.display = 'none';
                    resultsCard.style.display = 'block';
                    chartCard.style.display = 'block';
                    
                } catch (error) {
                    console.error('è®¡ç®—æˆ–ç»˜å›¾é”™è¯¯:', error);
                    alert('è®¡ç®—è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ•°æ®æ ¼å¼');
                    loadingIndicator.style.display = 'none';
                }
            }, 100);
        }
        
        // ç»˜åˆ¶å›¾è¡¨
        function drawChart(labels, values, colors, chartLines) {
            const ctx = document.getElementById('bandwidthChart').getContext('2d');
            
            // å¦‚æœå­˜åœ¨ç°æœ‰å›¾è¡¨ï¼Œé”€æ¯å®ƒ
            if (bandwidthChart) {
                bandwidthChart.destroy();
            }
            
            // è®¡ç®—æ•°æ®èŒƒå›´
            const minValue = Math.min(...values);
            const maxValue = Math.max(...values);
            
            // è·å–æ‰€æœ‰è¾¹ç•Œå€¼
            const boundaryValues = chartLines.map(line => line.value);
            const allValues = [...values, ...boundaryValues];
            const absoluteMin = Math.min(...allValues);
            const absoluteMax = Math.max(...allValues);
            
            // è®¡ç®—æ•°æ®èŒƒå›´
            const dataRange = absoluteMax - absoluteMin;
            
            // æ ¹æ®æ•°æ®èŒƒå›´ç¡®å®špaddingæ¯”ä¾‹
            let paddingRatio;
            if (dataRange < 0.5) {
                paddingRatio = 0.2;  // æ•°æ®èŒƒå›´å¾ˆå°æ—¶ï¼Œå¢åŠ padding
            } else if (dataRange < 2) {
                paddingRatio = 0.15;
            } else if (dataRange < 5) {
                paddingRatio = 0.1;
            } else if (dataRange < 10) {
                paddingRatio = 0.07;
            } else if (dataRange < 20) {
                paddingRatio = 0.05;
            } else {
                paddingRatio = 0.03;
            }
            
            // è®¡ç®—Yè½´èŒƒå›´
            const chartMin = Math.max(0, absoluteMin - (dataRange * paddingRatio));
            const chartMax = absoluteMax + (dataRange * paddingRatio);
            
            // è®¡ç®—åˆé€‚çš„æ­¥é•¿
            const range = chartMax - chartMin;
            let stepSize = calculateStepSize(range);
            
            // ç¡®ä¿Yè½´èŒƒå›´æ˜¯æ­¥é•¿çš„æ•´æ•°å€
            let finalMin = Math.floor(chartMin / stepSize) * stepSize;
            let finalMax = Math.ceil(chartMax / stepSize) * stepSize;
            
            // å¦‚æœèŒƒå›´éå¸¸å°ï¼Œç¡®ä¿è‡³å°‘æœ‰2ä¸ªåˆ»åº¦
            if (finalMax - finalMin < stepSize) {
                finalMin -= stepSize;
                finalMax += stepSize;
            }
            
            // ç¡®ä¿Yè½´èŒƒå›´è¶³å¤Ÿæ˜¾ç¤ºæ‰€æœ‰æ•°æ®å’Œè¾¹ç•Œçº¿
            const finalRange = finalMax - finalMin;
            
            // å¦‚æœæ•°æ®èŒƒå›´éå¸¸å°ï¼Œç¡®ä¿Yè½´è‡³å°‘æœ‰ä¸€å®šé«˜åº¦
            if (finalRange < 0.1) {
                const center = (finalMin + finalMax) / 2;
                // ä½¿ç”¨æ›´å°çš„æ­¥é•¿
                stepSize = 0.05;
                finalMin = Math.floor(chartMin / stepSize) * stepSize;
                finalMax = Math.ceil(chartMax / stepSize) * stepSize;
                
                // ç¡®ä¿è‡³å°‘æœ‰ä¸¤ä¸ªåˆ»åº¦
                if (finalMax - finalMin < stepSize) {
                    finalMin -= stepSize;
                    finalMax += stepSize;
                }
            }
            
            // åˆ›å»ºæ–°å›¾è¡¨
            bandwidthChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            data: values,
                            backgroundColor: colors,
                            borderColor: colors.map(color => {
                                const r = parseInt(color.slice(1, 3), 16);
                                const g = parseInt(color.slice(3, 5), 16);
                                const b = parseInt(color.slice(5, 7), 16);
                                return `rgb(${Math.max(0, r-30)}, ${Math.max(0, g-30)}, ${Math.max(0, b-30)})`;
                            }),
                            borderWidth: 1,
                            yAxisID: 'y',
                            barPercentage: 0.7,
                            categoryPercentage: 0.8
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(30, 36, 48, 0.9)',
                            titleColor: '#e0e6ef',
                            bodyColor: '#e0e6ef',
                            borderColor: '#3a4255',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const lacu = determineLACU(value, mean, std);
                                    return `${formatNumber(value)} (${lacu}åŒºé—´)`;
                                },
                                title: function(context) {
                                    return `æ•°æ®${context[0].dataIndex + 1}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false,
                                color: '#2a3140'
                            },
                            ticks: {
                                maxRotation: 45,
                                font: {
                                    size: 10
                                },
                                color: '#a0a6b0'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: false
                            },
                            grid: {
                                drawBorder: false,
                                color: '#3a4255', // ä¿®æ”¹ï¼šå°†ç½‘æ ¼çº¿é¢œè‰²è°ƒæµ…
                                drawOnChartArea: true
                            },
                            beginAtZero: false,
                            min: finalMin,
                            max: finalMax,
                            ticks: {
                                stepSize: stepSize,
                                // æ˜¾ç¤ºæ‰€æœ‰åˆ»åº¦å€¼
                                callback: function(value, index, values) {
                                    // ç¡®ä¿åˆ»åº¦å€¼æ˜¾ç¤ºæ ¼å¼ä¸€è‡´
                                    return formatNumber(value);
                                },
                                font: {
                                    size: 11
                                },
                                color: '#a0a6b0',
                                maxTicksLimit: 15  // å¢åŠ æœ€å¤§åˆ»åº¦é™åˆ¶
                            }
                        }
                    },
                    layout: {
                        padding: {
                            top: 10,
                            right: window.innerWidth < 768 ? 60 : 80,
                            bottom: 10
                        }
                    }
                },
                plugins: [{
                    id: 'lacLines',
                    afterDraw: function(chart) {
                        const ctx = chart.ctx;
                        const yAxis = chart.scales.y;
                        const xAxis = chart.scales.x;
                        const chartArea = chart.chartArea;
                        const isMobile = window.innerWidth < 768;
                        
                        // ç»˜åˆ¶çº¿æ¡
                        chartLines.forEach(line => {
                            const yPosition = yAxis.getPixelForValue(line.value);
                            
                            if (yPosition < chartArea.top || yPosition > chartArea.bottom) {
                                return;
                            }
                            
                            // ç»˜åˆ¶æ¨ªçº¿
                            ctx.save();
                            ctx.beginPath();
                            ctx.moveTo(xAxis.left, yPosition);
                            ctx.lineTo(xAxis.right, yPosition);
                            ctx.lineWidth = 2;
                            ctx.strokeStyle = line.color;
                            ctx.setLineDash([5, 3]);
                            ctx.stroke();
                            ctx.restore();
                            
                            // åœ¨çº¿çš„æœ€å³ä¾§æ·»åŠ æ ‡ç­¾
                            ctx.save();
                            
                            const labelText = `${line.label}: ${formatNumber(line.value)}`;
                            const fontSize = isMobile ? 10 : 12;
                            ctx.font = `bold ${fontSize}px Arial`;
                            const textWidth = ctx.measureText(labelText).width;
                            
                            const rectX = chartArea.right + (isMobile ? 3 : 5);
                            const rectY = yPosition - (isMobile ? 10 : 12);
                            const rectWidth = textWidth + (isMobile ? 8 : 10);
                            const rectHeight = isMobile ? 20 : 24;
                            const borderRadius = 6;
                            
                            if (rectY + rectHeight > chartArea.bottom) {
                                ctx.restore();
                                return;
                            }
                            
                            // ç»˜åˆ¶åœ†è§’çŸ©å½¢
                            ctx.beginPath();
                            ctx.moveTo(rectX + borderRadius, rectY);
                            ctx.lineTo(rectX + rectWidth - borderRadius, rectY);
                            ctx.quadraticCurveTo(rectX + rectWidth, rectY, rectX + rectWidth, rectY + borderRadius);
                            ctx.lineTo(rectX + rectWidth, rectY + rectHeight - borderRadius);
                            ctx.quadraticCurveTo(rectX + rectWidth, rectY + rectHeight, rectX + rectWidth - borderRadius, rectY + rectHeight);
                            ctx.lineTo(rectX + borderRadius, rectY + rectHeight);
                            ctx.quadraticCurveTo(rectX, rectY + rectHeight, rectX, rectY + rectHeight - borderRadius);
                            ctx.lineTo(rectX, rectY + borderRadius);
                            ctx.quadraticCurveTo(rectX, rectY, rectX + borderRadius, rectY);
                            ctx.closePath();
                            
                            ctx.fillStyle = line.lightColor;
                            ctx.fill();
                            
                            ctx.strokeStyle = line.color;
                            ctx.lineWidth = 1;
                            ctx.stroke();
                            
                            ctx.fillStyle = line.color;
                            ctx.textAlign = 'left';
                            ctx.textBaseline = 'middle';
                            ctx.fillText(
                                labelText, 
                                rectX + (isMobile ? 4 : 5), 
                                rectY + rectHeight/2
                            );
                            
                            ctx.restore();
                        });
                    }
                }, {
                    id: 'dataLabels',
                    afterDatasetsDraw: function(chart) {
                        const ctx = chart.ctx;
                        const meta = chart.getDatasetMeta(0);
                        
                        ctx.save();
                        
                        // æ ¹æ®å±å¹•å®½åº¦å’Œè®¾å¤‡ç±»å‹åŠ¨æ€è°ƒæ•´å­—ä½“å¤§å°
                        const isMobile = window.innerWidth < 768;
                        
                        // è®¡ç®—å¹³å‡æŸ±å®½ï¼Œç”¨äºè°ƒæ•´å­—ä½“å¤§å°
                        let totalBarWidth = 0;
                        let barCount = 0;
                        meta.data.forEach((bar) => {
                            if (bar.width > 0) {
                                totalBarWidth += bar.width;
                                barCount++;
                            }
                        });
                        const avgBarWidth = barCount > 0 ? totalBarWidth / barCount : 0;
                        
                        // åŠ¨æ€è°ƒæ•´å­—ä½“å¤§å° - æ‰‹æœºç«¯ä½¿ç”¨æ›´å°çš„å­—ä½“
                        let fontSize;
                        if (isMobile) {
                            // æ‰‹æœºç«¯æ ¹æ®æ•°æ®é‡è°ƒæ•´å­—ä½“å¤§å°
                            if (values.length > 15) {
                                fontSize = 7; // æ•°æ®å¾ˆå¤šæ—¶
                            } else if (values.length > 10) {
                                fontSize = 8; // æ•°æ®è¾ƒå¤šæ—¶
                            } else if (avgBarWidth < 25) {
                                fontSize = 8; // æŸ±å¾ˆçª„æ—¶
                            } else {
                                fontSize = 9; // æ­£å¸¸æƒ…å†µ
                            }
                        } else {
                            fontSize = 11; // æ¡Œé¢ç«¯
                        }
                        
                        ctx.font = `bold ${fontSize}px Arial`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'bottom';
                        
                        // è®°å½•å·²ç»ç»˜åˆ¶æ ‡ç­¾çš„ä½ç½®ï¼Œé˜²æ­¢é‡å 
                        const drawnLabels = [];
                        const minSpacing = fontSize * 1.2; // æœ€å°é—´è·ä¸ºå­—ä½“é«˜åº¦çš„1.2å€
                        
                        meta.data.forEach((bar, index) => {
                            const value = values[index];
                            if (bar.height > 10) { // é™ä½é«˜åº¦è¦æ±‚ï¼Œç¡®ä¿æ›´å¤šæ ‡ç­¾æ˜¾ç¤º
                                // ä½¿ç”¨æ ¼å¼åŒ–å‡½æ•°æ ¼å¼åŒ–æ•°å€¼
                                const formattedValue = formatNumber(value);
                                
                                // è®¡ç®—æ ‡ç­¾ä½ç½®
                                const labelX = bar.x;
                                const labelY = bar.y - 3;
                                
                                // æ£€æŸ¥æ˜¯å¦ä¸å·²ç»˜åˆ¶çš„æ ‡ç­¾é‡å 
                                let canDraw = true;
                                for (const drawn of drawnLabels) {
                                    const distance = Math.abs(drawn.x - labelX);
                                    if (distance < minSpacing && Math.abs(drawn.y - labelY) < minSpacing) {
                                        canDraw = false;
                                        break;
                                    }
                                }
                                
                                if (canDraw) {
                                    // ä¿®æ”¹ï¼šä½¿ç”¨æŸ±çŠ¶å›¾å¯¹åº”çš„é¢œè‰²ï¼Œè€Œä¸æ˜¯å›ºå®šçš„#e0e6ef
                                    ctx.fillStyle = colors[index];
                                    
                                    // ç»˜åˆ¶æ ‡ç­¾èƒŒæ™¯ï¼ˆå¯é€‰ï¼Œæé«˜å¯è¯»æ€§ï¼‰
                                    if (isMobile && fontSize < 9) {
                                        ctx.save();
                                        ctx.fillStyle = 'rgba(30, 36, 48, 0.7)';
                                        const textWidth = ctx.measureText(formattedValue).width;
                                        const padding = 2;
                                        ctx.fillRect(
                                            labelX - textWidth/2 - padding,
                                            labelY - fontSize - 1,
                                            textWidth + padding * 2,
                                            fontSize + 2
                                        );
                                        ctx.restore();
                                        
                                        // æ¢å¤æ–‡æœ¬é¢œè‰²
                                        ctx.fillStyle = colors[index];
                                    }
                                    
                                    ctx.fillText(
                                        formattedValue,
                                        labelX,
                                        labelY
                                    );
                                    
                                    // è®°å½•å·²ç»˜åˆ¶æ ‡ç­¾çš„ä½ç½®
                                    drawnLabels.push({ x: labelX, y: labelY });
                                }
                            }
                        });
                        
                        ctx.restore();
                    }
                }]
            });
        }
        
        // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œé‡æ–°ç»˜åˆ¶å›¾è¡¨
        window.addEventListener('resize', function() {
            if (bandwidthChart && currentData.length > 0) {
                const dataWithLACU = currentData.map(value => {
                    const lacu = determineLACU(value, mean, std);
                    return {
                        value,
                        lacu,
                        color: getLACUColor(lacu)
                    };
                });
                
                dataWithLACU.sort((a, b) => b.value - a.value);
                
                const labels = dataWithLACU.map((_, index) => `æ•°æ®${index + 1}`);
                const values = dataWithLACU.map(item => item.value);
                const colors = dataWithLACU.map(item => item.color);
                const boundaries = calculateLACUBoundaries(mean, std);
                const chartLines = getChartLines(boundaries);
                
                drawChart(labels, values, colors, chartLines);
            }
        });
    </script>
</body>
</html>